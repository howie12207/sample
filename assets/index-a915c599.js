import{g as he,e as pe,f as $,c as R,r as n,h as xe,_ as M,Y as Te,j as s,d as ge,m as ve,t as je,G as Me,H as Ue,w as be,v as He,Z as qe,o as Je,l as We,$ as Ze,I as z,J as _,K as U,S as Ce,x as we,z as Se,V as Re,y as Ke,R as Xe,U as Ye,D as k,E as L,W as P,a0 as Qe,X as le}from"./index-123815a0.js";import{f as De,S as V,F as ce}from"./Skeleton-813d987e.js";import{E as es}from"./Edit-3a56f1e6.js";import{A as ss}from"./Add-998b8f1c.js";function os(e){return he("MuiFormGroup",e)}pe("MuiFormGroup",["root","row","error"]);const ts=["className","row"],ns=e=>{const{classes:t,row:r,error:o}=e;return ve({root:["root",r&&"row",o&&"error"]},os,t)},rs=$("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.row&&t.row]}})(({ownerState:e})=>R({display:"flex",flexDirection:"column",flexWrap:"wrap"},e.row&&{flexDirection:"row"})),as=n.forwardRef(function(t,r){const o=xe({props:t,name:"MuiFormGroup"}),{className:l,row:a=!1}=o,u=M(o,ts),d=Te(),p=De({props:o,muiFormControl:d,states:["error"]}),f=R({},o,{row:a,error:p.error}),i=ns(f);return s.jsx(rs,R({className:ge(i.root,l),ownerState:f,ref:r},u))}),ls=as,cs=je(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),is=je(s.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),us=$("span")({position:"relative",display:"flex"}),ds=$(cs)({transform:"scale(1)"}),fs=$(is)(({theme:e,ownerState:t})=>R({left:0,position:"absolute",transform:"scale(0)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeIn,duration:e.transitions.duration.shortest})},t.checked&&{transform:"scale(1)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.shortest})}));function ye(e){const{checked:t=!1,classes:r={},fontSize:o}=e,l=R({},e,{checked:t});return s.jsxs(us,{className:r.root,ownerState:l,children:[s.jsx(ds,{fontSize:o,className:r.background,ownerState:l}),s.jsx(fs,{fontSize:o,className:r.dot,ownerState:l})]})}const ms=n.createContext(void 0),Ie=ms;function hs(){return n.useContext(Ie)}function ps(e){return he("MuiRadio",e)}const xs=pe("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary"]),ie=xs,gs=["checked","checkedIcon","color","icon","name","onChange","size","className"],vs=e=>{const{classes:t,color:r}=e,o={root:["root",`color${be(r)}`]};return R({},t,ve(o,ps,t))},js=$(Me,{shouldForwardProp:e=>Ue(e)||e==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[`color${be(r.color)}`]]}})(({theme:e,ownerState:t})=>R({color:(e.vars||e).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:e.vars?`rgba(${t.color==="default"?e.vars.palette.action.activeChannel:e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:He(t.color==="default"?e.palette.action.active:e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${ie.checked}`]:{color:(e.vars||e).palette[t.color].main}},{[`&.${ie.disabled}`]:{color:(e.vars||e).palette.action.disabled}}));function bs(e,t){return typeof t=="object"&&t!==null?e===t:String(e)===String(t)}const ue=s.jsx(ye,{checked:!0}),de=s.jsx(ye,{}),Cs=n.forwardRef(function(t,r){var o,l;const a=xe({props:t,name:"MuiRadio"}),{checked:u,checkedIcon:d=ue,color:p="primary",icon:f=de,name:i,onChange:h,size:m="medium",className:v}=a,j=M(a,gs),x=R({},a,{color:p,size:m}),c=vs(x),b=hs();let C=u;const g=qe(h,b&&b.onChange);let w=i;return b&&(typeof C>"u"&&(C=bs(b.value,a.value)),typeof w>"u"&&(w=b.name)),s.jsx(js,R({type:"radio",icon:n.cloneElement(f,{fontSize:(o=de.props.fontSize)!=null?o:m}),checkedIcon:n.cloneElement(d,{fontSize:(l=ue.props.fontSize)!=null?l:m}),ownerState:x,classes:c,name:w,checked:C,onChange:g,ref:r,className:ge(c.root,v)},j))}),fe=Cs,ws=["actions","children","defaultValue","name","onChange","value"],Ss=n.forwardRef(function(t,r){const{actions:o,children:l,defaultValue:a,name:u,onChange:d,value:p}=t,f=M(t,ws),i=n.useRef(null),[h,m]=Je({controlled:p,default:a,name:"RadioGroup"});n.useImperativeHandle(o,()=>({focus:()=>{let c=i.current.querySelector("input:not(:disabled):checked");c||(c=i.current.querySelector("input:not(:disabled)")),c&&c.focus()}}),[]);const v=We(r,i),j=Ze(u),x=n.useMemo(()=>({name:j,onChange(c){m(c.target.value),d&&d(c,c.target.value)},value:h}),[j,d,m,h]);return s.jsx(Ie.Provider,{value:x,children:s.jsx(ls,R({role:"radiogroup",ref:v},f,{children:l}))})}),Rs=Ss,ys=async e=>{const t=await z(`${_}/portfolio`,{method:"POST",body:JSON.stringify(e)});return(t==null?void 0:t.code)===200?(U.success("新增成功"),!0):!1},Is=async e=>{const t=new URLSearchParams;e&&Object.entries(e).forEach(([l,a])=>{a!==void 0&&t.append(l,String(a))});const r=t.toString()?`?${t.toString()}`:"",o=await z(`${_}/portfolioList${r}`);return(o==null?void 0:o.code)===200?o.data:!1},Ns=async e=>{const t=await z(`${_}/portfolio?_id=${e._id}`,{method:"PATCH",body:JSON.stringify(e)});return(t==null?void 0:t.code)===200?(U.success("編輯成功"),!0):!1},ks=async e=>{const t=await z(`${_}/portfolio?_id=${e}`,{method:"DELETE"});return(t==null?void 0:t.code)===200?(U.success("刪除成功"),!0):!1};function Ps(e,{threshold:t=0,root:r=null,rootMargin:o="0%",freezeOnceVisible:l=!1}={}){const[a,u]=n.useState(),d=a==null?void 0:a.isIntersecting,p=d&&l,f=([i])=>{u(i)};return n.useEffect(()=>{const i=e==null?void 0:e.current;if(!!!window.IntersectionObserver||p||!i)return;const m={threshold:t,root:r,rootMargin:o},v=new IntersectionObserver(f,m);return v.observe(i),()=>v.disconnect()},[e,r,o,p,t]),{entry:a,inView:d}}const Vs=({src:e,alt:t,height:r})=>{const o=n.useRef(null),[l,a]=n.useState(!0),u=()=>{a(!1)};return s.jsx(Ce,{children:s.jsx(we,{nodeRef:o,classNames:"page",unmountOnExit:!0,timeout:500,children:s.jsxs("div",{ref:o,children:[s.jsx("img",{src:e,alt:t,className:`${l?"!absolute !opacity-0":""} aspect-video w-full object-cover transition`,loading:"lazy",onLoad:u}),s.jsx(V,{...r?{height:r}:{},className:`${l?"":"!absolute !hidden"} skeleton-custom`})]})},l?"loading":"data")})},me=({data:e,isLoadingData:t,setPopup:r,setEditData:o})=>{const l=Se(d=>d.base.token),a=n.useRef(null),u=()=>{r&&o&&(r(),o())};return s.jsxs("article",{className:"relative h-full overflow-hidden rounded border border-red-50 bg-red-50 shadow transition hover:shadow-xl",children:[s.jsx(Vs,{src:e.img,alt:e.name,height:280}),s.jsx(Ce,{children:s.jsx(we,{nodeRef:a,classNames:"page",unmountOnExit:!0,timeout:500,children:s.jsx(s.Fragment,{children:s.jsx("div",{ref:a,className:" p-4",children:t?s.jsxs(s.Fragment,{children:[s.jsx(V,{width:"60%"}),s.jsx(V,{width:"30%"}),s.jsx(V,{width:"30%"}),s.jsx(V,{width:"30%"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[s.jsx("h2",{className:"text-xl font-bold text-red-700",children:e.name}),l&&s.jsx(es,{className:"cursor-pointer text-blue-500",onClick:u})]}),s.jsx("div",{className:"whitespace-pre-wrap",children:e.content}),s.jsxs("div",{className:"mt-2 flex gap-4 ",children:[e.pathDemo&&s.jsx("a",{href:e.pathDemo,className:"text-blue-500 hover:underline",title:"demo",target:"_blank",children:"Demo"}),e.pathCode&&s.jsx("a",{href:e.pathCode,className:"text-blue-500 hover:underline",title:"code",target:"_blank",children:"Code"}),e.url&&s.jsx("a",{href:e.url,className:"text-blue-500 hover:underline",title:"article",target:"_blank",children:"Article"})]})]})})})},t?"loading":"data")})]})},$s=({label:e,value:t,id:r,setValue:o,isValid:l,setIsValid:a,rules:u=[],immediate:d=!1,children:p,disabled:f=!1,placeholder:i="",setIsFocus:h,rows:m,cols:v},j)=>{const[x,c]=n.useState(!1),[b,C]=n.useState(""),g=()=>{c(!0),h&&h(!1),S()},w=I=>{const y=I.target.value;o(y),(d||x)&&S(y)},E=()=>{h&&h(!0)},S=(I=t)=>{if(u.length===0)return a(!0),!0;for(const y of u)if(!y.validate(I))return C(y.message),a(!1),!1;return a(!0),!0},F=(I=t)=>{const y=S(I);return c(!0),y},B=()=>{o(""),a(!1),c(!1)};return n.useImperativeHandle(j,()=>({validateNow:F,resetField:B})),s.jsxs("div",{className:`max-w-full flex-1 ${!l&&x?"error-item":""}`,children:[s.jsxs(s.Fragment,{children:[e&&s.jsx("label",{htmlFor:r,className:"mb-1 inline-block text-gray-700",children:e}),s.jsxs("div",{className:"relative sm:flex",children:[s.jsx("textarea",{className:["w-full rounded border px-3 py-2 outline-none transition focus:border-blue-700 disabled:bg-gray-300",`${!l&&x?"!border-red-500":""}`].join(" "),id:r,value:t,onBlur:g,onInput:w,onFocus:E,...f?{disabled:f}:{},...i?{placeholder:i}:{},...m?{rows:m}:{},...v?{cols:v}:{}}),p]})]}),s.jsx(Re,{in:!l&&x,children:s.jsx("div",{className:"my-1 min-h-[1.25rem] text-sm text-red-500",children:b})})]})},Es=n.forwardRef($s),Fs=({popup:e,setPopup:t,getPortfolioList:r,editData:o,setEditData:l})=>{const a=Ke(),{enqueueSnackbar:u}=Xe(),[d,p]=n.useState(!1),f=n.useRef(null),[i,h]=n.useState(""),[m,v]=n.useState(!1),j=[{validate:P,message:"請輸入名稱"}],[x,c]=n.useState(""),b=n.useRef(null),[C,g]=n.useState(""),[w,E]=n.useState(!1),S=[{validate:P,message:"請輸入圖片網址"}],F=n.useRef(null),[B,I]=n.useState(""),[y,H]=n.useState(!1),Ne=[{validate:P,message:"請輸入程式碼網址"}],q=n.useRef(null),[J,W]=n.useState(""),[ke,Pe]=n.useState(!1),Ve=[{validate:P,message:"請輸入Demo網址"}],[Z,K]=n.useState(""),[$e,Ee]=n.useState(!1),Fe=[{validate:P,message:"請輸入文章網址"}],X=n.useRef(null),[Y,Q]=n.useState(""),[Be,Ge]=n.useState(!1),Le=[{validate:P,message:"請輸入順序"},{validate:Qe,message:"僅接受數字"}],[D,ee]=n.useState(!0);n.useEffect(()=>{h((o==null?void 0:o.name)||""),c((o==null?void 0:o.content)||""),g((o==null?void 0:o.img)||""),I((o==null?void 0:o.pathCode)||""),W((o==null?void 0:o.pathDemo)||""),K((o==null?void 0:o.url)||""),Q(String((o==null?void 0:o.order)||"")),ee(!!((o==null?void 0:o.recommend)??!0))},[o]);const N=async()=>{var oe,te,ne,re,ae;if(![(oe=f.current)==null?void 0:oe.validateNow(),(te=b.current)==null?void 0:te.validateNow(),(ne=F.current)==null?void 0:ne.validateNow(),(re=q.current)==null?void 0:re.validateNow(),(ae=X.current)==null?void 0:ae.validateNow()].every(Ae=>Ae))return u("請確認紅框處內容");a(le(!0));const T={name:i,content:x,img:C,pathCode:B,pathDemo:J,url:Z,order:Number(Y),status:1,recommend:D},Oe=e==="add"?await ys(T):await Ns({...T,_id:o==null?void 0:o._id});a(le(!1)),Oe&&(r(),O())},ze=async()=>{if(!window.confirm(`請確認是否刪除 ${o==null?void 0:o.name}`))return;p(!0),await ks(o==null?void 0:o._id)&&(r(),O()),p(!1)},[G,se]=n.useState("");n.useEffect(()=>{G||se(e)},[e,G]);const O=()=>{t(""),setTimeout(()=>{l({}),se("")},500)},_e=A=>{ee(A.target.value==="true")};return s.jsx(Ye,{open:e==="add"||e==="edit",closeAfterTransition:!0,children:s.jsx(Re,{in:e==="add"||e==="edit",timeout:{enter:500,exit:500},children:s.jsxs("form",{className:"fixed left-1/2 top-1/2 flex max-h-[80%] w-[90%] max-w-[24rem] -translate-x-1/2 -translate-y-1/2 flex-col overflow-y-auto rounded bg-white px-4 py-8 text-sm sm:w-96",children:[s.jsx("h1",{className:"mb-4 h-auto text-center text-2xl font-bold text-blue-800",children:`${G==="add"?"新增":"編輯"}作品項目`}),s.jsxs("div",{className:"overflow-y-auto",children:[s.jsx(k,{ref:f,id:"life-name",label:"作品名稱",value:i,setValue:h,isValid:m,setIsValid:v,rules:j,placeholder:"請輸入作品名稱",enter:N}),s.jsx(Es,{id:"life-content",label:"描述",value:x,setValue:c,isValid:!0,setIsValid:()=>({}),placeholder:"請輸入描述"}),s.jsx(k,{ref:b,id:"life-img",label:"圖片網址",value:C,setValue:g,isValid:w,setIsValid:E,rules:S,placeholder:"請輸入圖片網址",enter:N}),s.jsx(k,{ref:F,id:"life-pathCode",label:"程式碼網址",value:B,setValue:I,isValid:y,setIsValid:H,rules:Ne,placeholder:"請輸入程式碼網址",enter:N}),s.jsx(k,{ref:q,id:"life-pathDemo",label:"Demo網址",value:J,setValue:W,isValid:ke,setIsValid:Pe,rules:Ve,placeholder:"請輸入Demo網址",enter:N}),s.jsx(k,{id:"life-pathArticle",label:"文章網址",value:Z,setValue:K,isValid:$e,setIsValid:Ee,rules:Fe,placeholder:"請輸入文章網址",enter:N}),s.jsx(k,{ref:X,id:"life-order",label:"排序",value:Y,setValue:Q,isValid:Be,setIsValid:Ge,rules:Le,placeholder:"請輸入排序",enter:N,inputmode:"numeric"}),s.jsx("label",{children:"是否推薦"}),s.jsxs(Rs,{className:"!flex-row",value:D,onChange:_e,children:[s.jsx(ce,{value:!0,control:s.jsx(fe,{size:"small"}),label:"是"}),s.jsx(ce,{value:!1,control:s.jsx(fe,{size:"small"}),label:"否"})]})]}),s.jsxs("div",{className:"flex h-auto justify-evenly pt-2",children:[s.jsx(L,{variant:"contained",onClick:N,disabled:d,children:"送出"}),G==="edit"&&s.jsx(L,{variant:"contained",color:"error",onClick:ze,disabled:d,children:"刪除"}),s.jsx(L,{color:"info",variant:"contained",onClick:O,children:"取消"})]})]})})})},_s=()=>{const e=Se(g=>g.base.token),[t,r]=n.useState(!0),[o,l]=n.useState(0),[a,u]=n.useState(0),[d,p]=n.useState(0),f=10,i=n.useRef(null),{inView:h}=Ps(i);n.useEffect(()=>{h&&d>a+1&&u(a+1)},[h]);const[m,v]=n.useState(Array.from({length:12},()=>({}))),j=n.useCallback(async({page:g,size:w}={})=>{g===0&&(window.scroll(0,0),u(0)),a===0&&r(!0);const S=await Is({page:g??a,size:w??f});S&&(v(a===0?S.list:[...m,...S.list]),l(S.totalCount),p(S.totalPage)),a===0&&r(!1)},[a,f]);n.useEffect(()=>{j()},[j]);const[x,c]=n.useState(""),[b,C]=n.useState({});return s.jsxs("section",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"作品清單"}),e&&s.jsx("div",{className:"text-right",children:s.jsxs(L,{variant:"contained",color:"secondary",onClick:()=>c("add"),children:[s.jsx(ss,{className:"!text-base"}),"新增"]})})]}),s.jsxs("section",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[m.map((g,w)=>s.jsx(me,{data:g,isLoadingData:t,setPopup:()=>c("edit"),setEditData:()=>C(g)},w)),s.jsx("div",{ref:i,className:"last-portfolio-card",children:o>m.length&&s.jsx(me,{data:{},isLoadingData:!0})})]}),s.jsx(Fs,{popup:x,setPopup:c,getPortfolioList:()=>j({page:0}),editData:b,setEditData:C})]})};export{_s as default};
